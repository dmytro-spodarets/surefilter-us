# CHANGELOG

Правила ведения истории изменений проекта.

### Как писать записи
- Формат: `YYYY-MM-DD — короткое описание изменения одной строкой`
- Язык: коротко и по делу, без подробностей реализации
- Каждая запись — новая строка, последние изменения добавляем выше

### Пример
- 2025-01-20 — Обновлён README, вынесены ROADMAP и CHANGELOG
- 2025-01-18 — Добавлена секция WhyChoose на главной странице
- 2025-01-15 — Настроена оптимизация изображений (Unsplash, WebP)

### История
- 2025-12-29 — Исправлен критический баг логирования: userId теперь берётся из session.userId вместо session.user.id, логирование работает корректно
- 2025-12-29 — Документация логирования: созданы ADMIN_LOGGING_README.md (quick guide) и обновлён LOGGING_IMPLEMENTATION.md с финальным статусом v0.0.94
- 2025-12-29 — Логирование Products завершено: добавлены UPDATE/DELETE, теперь Products полностью логируются (CREATE/UPDATE/DELETE), осталось News и Resources
- 2025-12-29 — Логирование основных операций завершено: Pages (CREATE/UPDATE/DELETE), Settings (UPDATE), Users (CREATE/UPDATE/DELETE), Products (CREATE) полностью работают, остальное можно добавить по шаблону
- 2025-12-29 — Логирование Pages и Settings завершено: CREATE/UPDATE/DELETE для Pages, UPDATE для Settings, все действия записываются в AdminLog с IP и User Agent
- 2025-12-29 — Начато логирование основных сущностей: добавлено логирование CREATE для Pages, создан LOGGING_IMPLEMENTATION.md с шаблонами для Products, News, Resources, Settings
- 2025-12-29 — Users и Activity Logs перемещены в Settings: теперь доступны через боковое меню Settings вместе с Site Settings, System Health и Debug Info
- 2025-12-29 — Исправлена отправка catalogPassword: добавлены поля в handleSaveSpecialPages, теперь пароль каталога действительно сохраняется в БД
- 2025-12-29 — Исправлена валидация site-settings: добавлен nullable для всех строковых полей (newsroom, resources, footer), теперь сохранение настроек работает с null значениями
- 2025-12-29 — Исправлена валидация catalogPassword: добавлен nullable для поддержки пустых значений, теперь сохранение пароля каталога работает корректно
- 2025-12-29 — Управление пользователями и логирование: CRUD для админов (создание/редактирование/удаление), страница Users в админке, таблица AdminLog для всех действий, страница просмотра логов, автоматическое логирование CREATE/UPDATE/DELETE, защита от самоудаления
- 2025-12-29 — Защита каталога паролем: новая вкладка Security в настройках, toggle для включения/выключения, красивая форма входа, пароль хранится в sessionStorage, API для проверки пароля
- 2025-12-29 — Реструктуризация URL ресурсов: /resources/[category] для категорий, /resources/[category]/[slug] для детальных страниц, логичная иерархия, улучшенная навигация "Back to Category"
- 2025-12-29 — Улучшены URL для категорий ресурсов: чистые роуты /resources/catalogs вместо query параметров, SEO friendly, автоматическая генерация static params для всех категорий, 404 для несуществующих категорий
- 2025-12-29 — Исправлена детальная страница ресурса: добавлен GET метод для прямого скачивания, передается file в ResourceDownloadForm, форма и скачивание работают корректно
- 2025-12-29 — Исправлены API для direct download: добавлено allowDirectDownload в схемы валидации POST/PUT, исправлен парсинг данных на странице /resources, теперь галочка сохраняется корректно
- 2025-12-29 — Добавлена возможность прямого скачивания ресурсов: новое поле allowDirectDownload в админке, ресурсы можно скачивать сразу со страницы /resources без перехода на детальную страницу, иконка скачивания вместо стрелки
- 2025-12-29 — Исправлено мигание изображений при retry: добавлен shimmer эффект во время повторной загрузки вместо показа placeholder, улучшен UX
- 2025-12-29 — Исправлена страница /resources: категории теперь отображаются корректно (API возвращает массивы напрямую)
- 2025-12-29 — Улучшен placeholder для изображений: теперь показывает логотип Sure Filter (серый, полупрозрачный) с текстом "Loading image..." вместо иконки, более профессиональный вид при ошибках загрузки
- 2025-12-29 — Миграция на ManagedImage ЗАВЕРШЕНА (16 компонентов): все публичные страницы, warranty секции, Logo, ProductGallery, catalog и resources теперь используют ManagedImage с автоматическим retry и fallback, admin компоненты оставлены для будущей миграции
- 2025-12-29 — Улучшена загрузка изображений (Best Practices December 2025): автоматический retry с exponential backoff, fallback на placeholder, shimmer эффект при загрузке, увеличен cache TTL до 30 дней, добавлен региональный S3 URL, создана документация IMAGE_LOADING_BEST_PRACTICES.md
- 2025-12-29 — Удаление fullSlug из FilterType: теперь используется только pageSlug (обязательное, уникальное поле), упрощена архитектура, все ссылки в related_filters работают корректно, создана миграция БД для удаления fullSlug
- 2025-12-28 — Очистка RESERVED_SLUGS: удалены warranty, about-us, contact-us, catalog, filters, test-colors из резерва, теперь можно создавать CMS страницы для этих URL
- 2025-12-28 — Удалены статичные страницы /warranty, /about-us, /contact-us: все страницы теперь управляются через CMS (динамический роут (site)/[...slug]), улучшена консистентность архитектуры, все контент редактируется через админку
- 2025-12-28 — Новый тип секции sidebar_widget: переиспользуемые sidebar виджеты с множественными блоками (Benefits, Stats, Badge, Custom HTML), интеграция с ContentWithImages для двухколоночного layout, динамическая форма с add/remove/reorder блоков, автоматическая загрузка данных из shared sections
- 2025-12-24 — Добавлены редактируемые изображения в PageHeroReverse: 4 поля для сетки 2x2 (image1-4), поддержка URL/S3/локальных путей, фоллбеки на дефолтные изображения, обновлена форма в админке
- 2025-12-24 — Интеграция Warranty компонентов в CMS: добавлены schemas, renderer, API валидация и admin формы для PageHeroReverse, MagnussonMossAct, LimitedWarrantyDetails, WarrantyContact; все компоненты без дефолтных значений, с проверками на undefined; создана тестовая страница /warranty-cms
- 2025-12-23 — Добавлена поддержка page-level overrides для Industry Showcase: возможность переопределить industryTitle и industryDescription для конкретной страницы при использовании Shared Section, независимое управление каждым полем, preview оригинальных значений из Shared Section
- 2025-12-23 — Исправлена работа Shared Sections: renderer теперь правильно использует sectionData (берет данные из sharedSection.data для Shared Sections и section.data для обычных секций), исправлено для всех 30+ типов секций
- 2025-12-23 — Исправлена динамическая ширина в FilterTypesImageGrid: заменены динамически генерируемые классы на статические предопределенные (Tailwind не компилирует динамические calc() с переменными), добавлена поддержка 2-8 колонок с правильными responsive breakpoints
- 2025-12-22 — Рандомизация продуктов в каталогах: FeaturedProductsCatalog показывает 8 случайных из добавленных, PopularFiltersCatalog показывает columnsPerRow случайных продуктов, обновление выборки при каждой перезагрузке страницы
- 2025-12-22 — Временное изменение ссылок в каталогах: все карточки продуктов ведут на общую ссылку (fallbackHref/catalogHref) вместо индивидуальных страниц продуктов
- 2025-12-22 — Исправлена загрузка статики на продакшене: добавлен workflow static-upload.yml для синхронизации /_next/static/* из Docker образа на S3, CloudFront invalidation для обновления кеша
- 2025-12-22 — Исправлено центрирование неполных рядов в FilterTypesImageGrid: переход с CSS Grid на Flexbox (flex flex-wrap justify-center) для правильного центрирования последней строки
- 2025-12-22 — Улучшения админки каталогов: Featured Products Catalog и Popular Filters Catalog теперь загружают 200 продуктов для поиска (вместо 20), показывают все результаты без лимита, улучшенные индикаторы загрузки
- 2025-12-22 — Исправлена загрузка изображений в админке каталогов: API /api/admin/products теперь возвращает media с asset для отображения картинок, добавлена поддержка параметра ids для загрузки конкретных продуктов
- 2025-12-22 — Улучшения MediaPickerModal: добавлена пагинация (Load More), поиск по всем файлам в папке через API (не только по загруженным), debounced search 300ms, улучшенные индикаторы загрузки
- 2025-12-20 — Исправлено центрирование неполных рядов в FilterTypesImageGrid (justify-center вместо justify-items-center)
- 2025-12-20 — Оптимизирован API /api/admin/products: возвращает _count вместо полных данных для списка продуктов (быстрее и эффективнее)
- 2025-12-17 — Исправлена обработка пустых code в ProductFilterType: пустые строки конвертируются в null для корректной работы unique constraint
- 2025-12-14 — Настроено SSL подключение к AWS RDS PostgreSQL: rejectUnauthorized: false для self-signed сертификатов, шифрование соединения
- 2025-12-09 — Новый CMS компонент Popular Filters Catalog: аналог Featured Products Catalog для популярных фильтров, выбор продуктов из каталога, автоматическая подгрузка данных, поиск и упорядочивание в админке
- 2025-12-09 — Улучшения конфигурации Next.js: добавлена поддержка Turbopack (resolveAlias для pg-native), настроено images.qualities для Next.js 16+, исправлена обработка пустых src в ManagedImage
- 2025-12-08 — Очистка кода: удален неиспользуемый роут /admin/pages/[slug]/sections/[sectionId], все редактирование секций через /admin/sections/[id]
- 2025-12-08 — Новый CMS компонент Featured Products Catalog: выбор продуктов из каталога вместо ручного ввода, автоматическая подгрузка данных (изображения, названия, описания), поиск и упорядочивание продуктов в админке, отображение типа фильтра в badge, Server Component с загрузкой из БД
- 2025-12-08 — Добавлена модель ProductFilterType: отдельная таблица для типов фильтров каталога (Air, Oil, Fuel и т.д.), 5 API endpoints, 3 админ страницы, интеграция с формой продукта, иконки и ACES коды, защита от удаления используемых типов
- 2025-12-07 — Обновление на Prisma 7.1.0: Node.js 20.19.6, PostgreSQL driver adapter (@prisma/adapter-pg), prisma.config.ts в корне проекта для CLI, убран url из schema.prisma, shared prisma instance в API routes, обновлены Dockerfile и GitHub Actions workflows, build без warnings
- 2025-11-18 — Hero Carousel: исправлена логика loop mode (требуется минимум 3 слайда, автоматическое отключение при 1-2 слайдах), оптимизирован autoplay (3sec вместо 5sec), убрана пауза при наведении мыши, исправлена TypeScript ошибка с loading prop, production build успешен
- 2025-11-18 — Hero Carousel: добавлен HeroCarouselCms компонент с Swiper.js (slide transitions, autoplay, loop, navigation arrows, pagination dots, keyboard support, touch/swipe на мобильных, accessibility), админ-форма с управлением слайдами (вверх/вниз), настройки autoplay/navigation/pagination, поддержка prefers-reduced-motion
- 2025-11-18 — Консолидация Header/Footer компонентов: оставлены 2 основных (Header и Footer как Server Components), Header разделён на sub-components (ScrollHeader, HeaderNav, MobileMenu), все публичные страницы конвертированы в Server Components для SEO, удалены дублирующие компоненты
- 2025-11-18 — Оптимизация архитектуры Resources: страница /resources/[slug] переведена на Server Component с Client sub-component для формы, удалена статичная страница /resources/heavy-duty-catalog (весь функционал через админку), карточки ресурсов полностью кликабельны с hover эффектами
- 2025-11-01 — Site Settings система: управление Header Navigation и Footer через админку, настройки Special Pages (Newsroom/Resources hero и SEO), отдельные кнопки сохранения для каждой секции, данные автоматически загружаются в Header/Footer компоненты
- 2025-10-28 — Система News и Events: единая модель с полем type (NEWS/EVENT), категории новостей, TinyMCE редактор для контента, featured events на главной странице, автоматическая загрузка последних новостей в AboutNewsCms, публичная страница /newsroom с каруселью событий и списком новостей
- 2025-10-26 — Универсальная система форм (Universal Forms System): конструктор форм с 7 типами полей, drag-and-drop, webhook интеграция с retry логикой, экспорт в CSV, встраивание через CMS, система Resources с категориями и gated downloads через формы, улучшенная навигация админки с dropdown меню и breadcrumbs
- 2025-10-20 — Оптимизация изображений: shimmer placeholders, priority loading для hero, оптимизированные sizes для всех Image компонентов, автоматическое сжатие при загрузке (1MB max, 2048px), preload логотипа
- 2025-10-20 — Замена всех `<img>` на Next.js Image компонент: PopularFilters, ManufacturingFacilities, AwardsCarousel, ContactHero (WebP/AVIF, lazy loading, responsive)
- 2025-10-20 — Новый CMS компонент FilterTypesImageGrid с изображениями вместо иконок: 16:9 формат, прижатие к низу, hover подчеркивание, настраиваемые колонки (2-8) и варианты стиля (card/simple)
- 2025-10-20 — Улучшения CMS компонентов: WhyChooseCms (flexbox центрирование последней строки), FeaturedProductsCms (категория поверх изображения)
- 2025-10-20 — Очистка кодовой базы: удалены 6 дублирующихся компонентов (Hero, AboutNews, QuickSearch, FeaturedProducts, WhyChoose, Industries), оставлены только CMS версии
- 2025-10-20 — Исправления изображений: добавлен getAssetUrl для правильных путей к CDN во всех CMS компонентах (IndustriesCms, IndustriesList, PopularFilters и др.)
- 2025-10-20 — Исправление сборки: страница /industries/agriculture переведена на dynamic rendering из-за использования БД запросов
- 2025-09-23 — Полная система управления файлами: S3/MinIO интеграция, папки с вложенностью, превью изображений/видео/PDF, копирование CDN ссылок для контента
- 2025-09-10 — Прод: домен `new.surefilter.us` через CloudFront+ACM+Route53, канонический домен (middleware) и защита origin заголовком; статика вынесена в S3+CloudFront
- 2025-09-10 — CI: сборка и публикация образа с input `version`; извлечение статики из образа и выгрузка в S3; опциональная инвалидация CloudFront
- 2025-09-10 — DB: добавлены workflows `DB - Prisma Migrate Deploy` и `DB - Restore from Repo Dump`; миграции запускаются вручную, восстановление из локального дампа поддержано
- 2025-09-10 — Infra: ECR репозиторий, App Runner сервис, RDS PostgreSQL (public, minimal), SSM параметры (`/surefilter/DATABASE_URL`, `/surefilter/NEXTAUTH_SECRET`, `/surefilter/ORIGIN_SECRET`)
- 2025-09-10 — Безопасность: Dockerfile обновлён (apt-get upgrade) для закрытия CVE (pam), URL‑эскейп пароля в `DATABASE_URL`
- 2025-09-04 — Добавлена админ‑панель для параметров спецификаций продуктов; редактор спецификаций в ProductForm; API продуктов принимает/сохраняет specValues и возвращает их; Prisma схема синхронизирована и клиент сгенерирован
- 2025-08-26 — Полный переход на listing_card_meta вместо industry_meta (миграции, формы, рендер); возвращена кнопка удаления секций в универсальном редакторе
- 2025-08-26 — Related Filters: сохранён исходный дизайн, авто-наполнение по категории через FilterTypesCms; мета карточек берётся из listing_card_meta
- 2025-08-26 — Админка: улучшено добавление секций (ошибки API и редирект на редактор новой секции)
- 2025-08-26 — Валидация слугов: разрешены многоуровневые слуги с префиксами heavy-duty/automotive (создание/обновление)
- 2025-08-25 — Heavy Duty страница переведена на CMS: добавлены секции search_hero и filter_types_grid; рендер страницы из CMS; сидинг контента
- 2025-08-25 — Секция Industries (CMS) стала динамической: `IndustriesCms` подтягивает список INDUSTRY‑страниц и их `industry_meta` из БД
- 2025-08-25 — Категории/типы фильтров: добавлены модели FilterCategory/FilterType; раздел админки /admin/filter-types; сид верхнеуровневых типов; автосоздание CMS‑страниц для каждого типа; страницы типов скрыты из общего списка Pages
- 2025-08-25 — Индустрии в CMS: добавлены секции compact_search_hero, simple_search, popular_filters, related_filters; industries_list рендерит список из INDUSTRY‑страниц по их industry_meta; формы в админке
- 2025-08-25 — Админка: раздел /admin/industries (список INDUSTRY‑страниц), редактор секций по id /admin/sections/[id]; единый catch‑all API /api/admin/pages/[...slug] с POST (добавление секции) и PUT action=reorder; удалены дублирующие одиночные роуты
- 2025-08-25 — Роутинг сайта: catch‑all /(...)/[...slug] рендерит CMS‑страницы, временно использует некешированный загрузчик для dev; исправлен рендер compact_search_hero
- 2025-08-25 — Конфиг изображений: next.config.ts разрешает http://localhost:3000 для next/image
- 2025-08-25 — Подключена страница Contact Us к CMS; добавлены секции contact_hero, contact_options, contact_form_info; формы в админке; рендерер; сидинг
- 2025-08-25 — Добавлен роут для верхнеуровневых CMS‑страниц `/(site)/[slug]` с рендером секций и метаданными
- 2025-08-25 — Админка: модальное создание страниц, редактирование slug, удаление страниц; защита от удаления core‑страниц; список защищённых слегов
- 2025-08-25 — Обновлён сидер и AddSectionForm: актуальные типы секций, удалены legacy‑контактные блоки при наличии contact_form_info; валидация и revalidateTag в API
- 2025-08-25 — Подключена страница About Us к CMS; добавлены типы секций page_hero, about_with_stats, content_with_images, quality_assurance; формы в админке; сидинг контента
- 2025-08-21 — Внедрён CMS для главной страницы: секции hero_full, featured_products, why_choose, quick_search, industries, about_news; добавлена админка страниц/секций, порядок секций, рендер на сервере, кеширование с revalidateTag
- 2025-08-20 — Добавлена Docker-конфигурация Postgres (docker-compose), пример env; переход на единый глобальный .gitignore
- 2025-08-11 — Восстановлен и расширен раздел «Как вести разработку», дополнена структура и разделы README без удаления существующего
- 2025-08-10 — Добавлены страницы filters/[code] и catalog, компоненты ProductGallery/ProductSpecs/ContactOptions/Pagination; обновлён CTA на главной; обновлены README/ROADMAP
- 2025-08-10 — README разделён; добавлены ROADMAP.md и CHANGELOG.md; README упрощён и актуализирован
